---
title: "Probability and Statistics"
author: "Mac Strelioff"
date: "2019-08-29 13:52:00"
math: true
output:
  blogdown::html_page:
    toc: true
    toc_depth: 4
menu:
  InsightStudying:
    parent: Foundations
    weight: 20
linktitle: Probability and Statistics
---


<div id="TOC">
<ul>
<li><a href="#events-and-random-variables">Events and Random Variables</a><ul>
<li><a href="#probability-rules">Probability Rules</a></li>
<li><a href="#probability-functions">Probability Functions</a></li>
<li><a href="#expectation">Expectation</a></li>
<li><a href="#variance">Variance</a></li>
<li><a href="#information-theory">Information Theory</a></li>
<li><a href="#causal-inference">Causal Inference</a></li>
</ul></li>
<li><a href="#experiment-design">Experiment Design</a><ul>
<li><a href="#foundations">Foundations</a></li>
<li><a href="#concerns">Concerns</a></li>
<li><a href="#treatment-units">Treatment Units</a></li>
<li><a href="#generative-model-and-adjustment-variables">Generative Model and Adjustment Variables</a></li>
<li><a href="#common-designs">Common Designs</a></li>
<li><a href="#assignment-mechanism">Assignment Mechanism</a></li>
<li><a href="#duration">Duration</a></li>
<li><a href="#integrety-checks">Integrety Checks</a></li>
<li><a href="#maximum-likelihood-versus-bayes-estimators">Maximum Likelihood versus Bayes’ Estimators</a></li>
</ul></li>
<li><a href="#glms">GLMs</a></li>
<li><a href="#common-tests">Common Tests</a><ul>
<li><a href="#t-test">t-test</a></li>
<li><a href="#anova">ANOVA</a></li>
<li><a href="#linear-model">Linear Model</a></li>
<li><a href="#z-test-for-proportions">Z test for proportions</a></li>
<li><a href="#chi-square">Chi-Square</a></li>
<li><a href="#logistic-regression">Logistic Regression</a></li>
<li><a href="#likelihood-ratio-and-bayes-factors">Likelihood Ratio and Bayes Factors</a></li>
<li><a href="#always-valid-p-values-ck-optimizely-white-paper">always valid p-values (ck optimizely white paper)</a></li>
</ul></li>
<li><a href="#different-estimands-for-ci">Different Estimands For CI</a></li>
<li><a href="#more-on-variance">more on variance</a><ul>
<li><a href="#emperical-variance-estimation">Emperical Variance Estimation</a></li>
<li><a href="#mixed-effects-models">Mixed Effects Models</a></li>
<li><a href="#effiencicy-or-variance-reduction">Effiencicy or Variance Reduction</a></li>
<li><a href="#glms-1">GLMs</a></li>
</ul></li>
<li><a href="#causal-inference-methods">Causal Inference Methods</a><ul>
<li><a href="#difference-in-differences">Difference in Differences</a></li>
<li><a href="#causal-impact">Causal Impact</a></li>
<li><a href="#synthetic-controls">Synthetic Controls</a></li>
<li><a href="#propensity-score-matching">Propensity Score Matching</a></li>
<li><a href="#fixed-effects-regression">Fixed Effects Regression</a></li>
<li><a href="#instrumental-variables">Instrumental variables</a></li>
<li><a href="#regression-discontinuity">Regression Discontinuity</a></li>
</ul></li>
</ul>
</div>

<!--
Fermi problems (order of magnitude)
-->
<!--
- Make YouTube videos on each!
-->
<!--
# What is a probability, and how does that relate to statistics? 

- Probabilities are commonly thought of in three ways; 

1. Purely mathematical
2. Magnitudes of belief
3. Relative frequencies of infinate events

I use probability theory to quantify beliefs and make decisions. 

Logic, about truths of the universe. 
By there is uncertainty in what we know, and uncertainty in our measurements and observations. Statistics as a field is concerned with specifying our knowledge of the laws of the universe and the uncertainty around them. They do this by applying probability theory. 

Probability theory generalizes logic to situations where we aren't certain. And logic emerges from probability theory when we know things with certainty. 

Hypothesis testing

Statisticians use probability theory to decide on what is and isn't true
-->
<div id="events-and-random-variables" class="section level1">
<h1>Events and Random Variables</h1>
<p>Events, event spaces,</p>
<p>combinatorics (permutations and combinations)</p>
<p>A random variable random variable is a variable with an unknown value, but known possible values. An event is an observed value of a random variable. An event space contains all possible values of the random variable. Probabilities are values assigned to the events in an event space (i.e. the possible values of a random variable) and represent how likely each event is relative to other events in the event space.</p>
<p>Here <span class="math inline">\(p(e)\)</span> will be used to represent the probability of an event. Some special probabilities include the probability of any event in the event space, which is 1. And the probability of any event other than <span class="math inline">\(p(e)\)</span>, known as the compliment of <span class="math inline">\(p(e)\)</span>, denoted with <span class="math inline">\(p(\neg e)\)</span>, is found by;</p>
<p><span class="math display">\[
p(\neg e) = 1 - p(e)
\]</span></p>
<div id="probability-rules" class="section level2">
<h2>Probability Rules</h2>
<p>A joint event refers to two or more events occurring together. They are colloquially talked about as one event ‘and’ another event occurring together. More formally, joint events are called intersections (represented with the <span class="math inline">\(\cap\)</span> symbol) between events. For events <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span>, the probability of their joint event will be represented with <span class="math inline">\(p(e_1 \cap e_2)\)</span>. The probability of an intersection of events is the same regardless of which event is considered first;</p>
<p><span class="math display">\[
p(e_1 \cap e_2) = p(e_2 \cap e_1)
\]</span></p>
<p>For two events, <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span>, their intersection is found by; <span class="math display">\[
p(e_1 \&amp; e_2) = p(e_1\cap e_2) = p(e_1|e_2)p(e_2)
\]</span> where <span class="math inline">\(p(e_1|e_2)\)</span> is a conditional probability, discussed in the next section.</p>
<p>Conditional events refer to one event, <span class="math inline">\(e_1\)</span>, after another event, <span class="math inline">\(e_2\)</span>, is known. <span class="math inline">\(p(e_1|e_2)\)</span> represents the probability of <span class="math inline">\(e_1\)</span> given, or after knowing, <span class="math inline">\(e_2\)</span>. These can be defined by rearranging the multiplication rule as follows; <span class="math display">\[
p(e_1|e_2)p(e_2)=p(e_1\cap e_2) \Rightarrow p(e_1|e_2)= \frac{p(e_1\cap e_2)}{p(e_2)}
\]</span></p>
<p>Noting that, by the reflexively of joint events and the definition of the multiplication rule, <span class="math inline">\(p(e_1 \cap e_2) = p(e_2 \cap e_1)= p(e_2 | e_1) p(e_1)\)</span>, and so the above equation becomes; <span class="math display">\[
p(e_1|e_2)=\frac{p(e_2 | e_1) p(e_1)}{p(e_2)}
\]</span> This equation is known as Bayes’ Theorem or Bayes’ Rule.</p>
<p>A union (represented with the <span class="math inline">\(\cup\)</span> symbol) of events refers to at least one of multiple events occurring. For events, <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span>, their union would include the probability that <span class="math inline">\(e_1\)</span> occurs, the probability that or <span class="math inline">\(e_2\)</span> occurs, and the probability that both <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span> occur. Colloquially this is talked about the probability of <span class="math inline">\(e_1\)</span> ‘or’ <span class="math inline">\(e_2\)</span>. Formally this is expressed and computed as; <span class="math display">\[
p(e_1\text{ or } e_2) = p(e_1 \cup e_2) = p(e_1) + p(e_2) - p(e_1 \cap e_2)
\]</span></p>
<p>Where <span class="math inline">\(p(e_1 \cap e_2)\)</span> is a joint probability.</p>
<p>Independence is a common assumption in many statistical techniques. Statisticians assume independence primarily because it simplifies the computation of certain probabilities. Events are said to be independent if knowing one event does not change the probability of the other event. Formally, if events <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span> are independent, this would mean that; <span class="math display">\[
\begin{aligned}
p(e_1|e_2) &amp;= p(e_1) \\
p(e_2|e_1) &amp;= p(e_2)
\end{aligned}
\]</span></p>
<p>If <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span> are independent, then their joint probability simplifies as so; <span class="math display">\[
p(e_1 \cap e_2) = p(e_1|e_2)p(e_2) = p(e_1)p(e_2)
\]</span> Where the last equality is only true if <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span> are independent (i.e. <span class="math inline">\(p(e_1|e_2)=p(e_1)\)</span>).</p>
<p>Then the probability of their union simplifies to; <span class="math display">\[
\begin{aligned}
p(e_1 \cup e_2) &amp;= p(e_1) + p(e_2) - p(e_1|e_2)p(e_2) \\
&amp;= p(e_1) + p(e_2) - p(e_1)p(e_2)
\end{aligned}
\]</span> Where again, the last part of this equality is only true if <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span> are independent.</p>
<p>Events <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span> are said to be mutually exclusive if the occurrence of either event precludes the occurrence of the other event. Formally mutual exclusivity means that; <span class="math display">\[
p(e_1 | e_2) = 0 \text{ and } p(e_2 | e_1) = 0
\]</span></p>
<p>If two events are mutually exclusive, then the probability of their joint event is; <span class="math display">\[
\begin{aligned}
p(e_1 \cap e_2) &amp;= p(e_1|e_2)p(e_2) \\
&amp;= 0*p(e_2) \\
&amp;= 0
\end{aligned}
\]</span></p>
<p>And the probability of their union simplifies to; <span class="math display">\[
\begin{aligned}
p(e_1 \cup e_2) &amp;= p(e_1) + p(e_2) - p(e_1 \cap e_2) \\
&amp;= p(e_1) + p(e_2) - 0 \\
&amp;=p(e_1) + p(e_2)
\end{aligned}
\]</span></p>
<!--
## Practice Problems and Walkthroughs

- link to my YouTube videos on these things

Practice problems on the amoeba [here](https://www.quora.com/Bobo-the-amoeba-has-a-25-25-and-50-chance-of-producing-0-1-or-2-offspring-respectively-Each-of-Bobos-descendants-also-have-the-same-probabilities-What-is-the-probability-that-Bobos-lineage-dies-out) and  [here](https://www.quora.com/An-amoeba-has-a-75-chance-of-splitting-in-two-and-25-chance-of-dying-Is-there-an-intuitive-reason-why-the-probability-of-extinction-is-not-1).
-->
</div>
<div id="probability-functions" class="section level2">
<h2>Probability Functions</h2>
<!--
Many machine learning algorithms are different ways of estimating f(x)
-->
<p>Here I’ll describe the properties and use cases for probability functions and cumulative probability functions. Conventionally, use <span class="math inline">\(f(x)\)</span> is used represent a probability function, and <span class="math inline">\(F(x)\)</span> to represent a cumulative probability function. <span class="math inline">\(f(x)\)</span> is commonly called a probability mass function (pmf) if <span class="math inline">\(x\)</span> is discrete, and a probability density function (pdf) if <span class="math inline">\(x\)</span> is continuous. <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(F(x)\)</span> are related through integration:</p>
<p><span class="math display">\[
\begin{aligned}
f(x) &amp;= \frac{d}{dx}F(x) \\
F(x) &amp;= \int_{-\infty}^{\infty} f(x) d_{x}
\end{aligned}
\]</span></p>
<p>For discrete variables, the probability function represents the probability that <span class="math inline">\(X\)</span> takes a specific value <span class="math inline">\(x\)</span>: <span class="math inline">\(f(x) = p(X=x)\)</span>. For continuous variables, the probability that the variable <span class="math inline">\(X\)</span> takes any particular value is technically <span class="math inline">\(0\)</span>; <span class="math inline">\(p(X=x)=0\)</span>. However, <span class="math inline">\(p(x)\)</span> is still related to probability functions <span class="math inline">\(f(x)\)</span> through areas. For an arbitrarily small <span class="math inline">\(\epsilon\)</span> the probability that <span class="math inline">\(X\)</span> takes a value between <span class="math inline">\(x-\epsilon\)</span> and <span class="math inline">\(x+\epsilon\)</span> is the area of the distribution over that range;</p>
<p><span class="math display">\[
\begin{aligned}
p( x - \epsilon&lt; x &lt; x+\epsilon) &amp;= F(x+\epsilon) - F(x-\epsilon) \\
&amp;= \int_{-\infty}^{(x-+\epsilon)}f(x)d_{x} - \int_{-\infty}^{(x-\epsilon)}f(x)d_{x}
\end{aligned}
\]</span></p>
<p>Probability functions have to satisfy a few conditions:</p>
<ol style="list-style-type: decimal">
<li></li>
<li></li>
<li></li>
</ol>
<!--
Transformations of variables!
-->
<!--
CDF transformation to convert from uniform into any random variable with a CDF
-->
<!--
Link to YouTube video on the circle problem
- circle problem
-->
<!--
### Probability Distributions
Make YouTube videos on each. 
- 1) Walk through properties from Wikipedia!
- 2) Walk through some simulations in Python!
-->
<!--
## Central limit theorem

Sum of any random variable converges to normal distribution. 
- show for binomial case, to justify Z test
-->
</div>
<div id="expectation" class="section level2">
<h2>Expectation</h2>
<!--
expectation, variance, conditional or iterated expectations, law of total variance, variance of multiple variables
-->
<p>For any functions of a randome variable, <span class="math inline">\(g(x)\)</span>, the expectation of that function is;</p>
<p><span class="math display">\[
E_{x}(g(x))=\int_{-\infty}^{\infty}g(x)f(x)d_{x}
\]</span></p>
<p>For discrete random variables, <span class="math inline">\(E(x)=\sum_xxp(x)\)</span>. For continuous random variables, <span class="math inline">\(f(x)dx\)</span> is conceptually <span class="math inline">\(p(x)\)</span> since it is the area under an infinately small segment of the probability function if <span class="math inline">\(f(x)\)</span> represents the height and <span class="math inline">\(dx\)</span> represents an infinately small width.</p>
<p>Expectation is a linear operator, so for constants <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(c\)</span> and random variables <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>; <span class="math inline">\(E(ax+by+c) = aE(x)+bE(y)+c\)</span>.</p>
<p>Expectation for joint random variables</p>
<p><span class="math display">\[
E_{x,y}(g(x,y))=\int_{s=x}\int_{t=y}g(s,t)f(s,t)d_{s}d_{t}
\]</span></p>
<p>Marginalizing a distribution from a joint probability function (<span class="math inline">\(f(x,y)\)</span>) or a conditional probability function (<span class="math inline">\(f(x|y)\)</span>): <span class="math display">\[
\begin{aligned}
f_x(x)&amp;=\int_yf_{x,y}(x,y)d_{y}\\
&amp;=\int_y f_{x|y}(x|y)f_y(y)d_{y}\\
&amp;=E_y(f(x|y))
\end{aligned}
\]</span></p>
<p><a href="https://en.wikipedia.org/wiki/Law_of_total_expectation">Law of total expectation, and rough proof</a></p>
<p><span class="math display">\[
\begin{aligned}
E_{x}(x)&amp;=E_{y}(E_{x|y}(x|y))\\
&amp;=\int_y\int_{x}xf_{x|y}(x|y)d_{x}f(y)d_{y} \\
&amp;=\int_{x}x\int_{y}f_{x|y}(x|y)f(y)d_{y}d_{x} \\
&amp;=\int_{x}xf(x)d_{x}\\
&amp;=E_{x}(x)
\end{aligned}
\]</span></p>
<p>The last steps reflect that the internal integral is just marginalizing across y; <span class="math inline">\(f_x(x)=\int_y f_{x|y}(x|y)f_y(y)d_{y}\)</span>.</p>
<!--
Linear regression as a conditional expectation
Could show a simple figure with Y~1 and Y~X as example of expectation versus conditional expectation

Conditional expectation 
$$
E(g(x)|Z)=\int_{-\infty}^{\infty}p(x|Z)g(x)dx
$$

in linear regression, the expectation of Y is the linear combination of X and B, since those are deterministic, and the only non-deterministic part, epsilon, has expectation 0. 

- So the property that expectation propogates through sums leads to this result..
--->
</div>
<div id="variance" class="section level2">
<h2>Variance</h2>
<p>Covariance and variance</p>
<p><span class="math display">\[
\begin{aligned}
Cov(X,Y)&amp;=E_{x,y}((X-E_{x}(X))(Y-E_{y}(Y)))\\
Var(X)&amp;=Cov(X,X)=E_{x}((X-E_{x}(X))^2) \\
&amp;= E(X^2)-E(X)^2
\end{aligned}
\]</span></p>
<p>The <a href="https://en.wikipedia.org/wiki/Bias%E2%80%93variance_tradeoff">Bias-Variance tradeoff</a> decomposes the theoretical variance obtained when estimating a function <span class="math inline">\(g(x)\)</span> with a model <span class="math inline">\(\hat{g}(x)\)</span> into three components that can be used to motivated changes to the model. Specifically, the Bias-Variance tradeoff is a decomposition of the expected prediction error; <span class="math inline">\(g(x)-\hat{g}(x)\)</span>. To see it’s relation to variance, first rearrange the variance equation above:</p>
<p><span class="math display">\[
\begin{aligned}
Var(X)= E(X^2)-E(X)^2 \\
\Rightarrow E(X^2) = Var(X)+E(X)^2 \\
\end{aligned}
\]</span></p>
<p>Then define the random variable <span class="math inline">\(X\)</span> to be the errors of the model;</p>
<p><span class="math display">\[
\begin{aligned}
E((g(x)-\hat{g}(x))^2) &amp;= Var((g(x)-\hat{g}(x))^2)+E((g(x)-\hat{g}(x)))^2 \\
&amp;= (g(x)-E(\hat{g}(x)))^2 + E((E(\hat{g}(x))-\hat{g}(x))^2) + Var(g(x))\\
&amp;= Bias(\hat{g}(x))^2 + Var(\hat{g}(x)) + Var(g(x))
\end{aligned}
\]</span></p>
<p>Here bias represents the squared error between the true function <span class="math inline">\(g(x)\)</span> and the expected model <span class="math inline">\(E(\hat{g}(x))\)</span>. Variance represents the squared error between the expected model and the obtained model. And <span class="math inline">\(Var(g(x))\)</span> represents the true noise or irreducible error in the process <span class="math inline">\(g(x)\)</span>.</p>
<p>Variance of linear combinations of random variables:</p>
<p><span class="math display">\[
Var(aX+bY+c)=a^2Var(X)+b^2Var(Y)+2abCov(X,Y)
\]</span></p>
<p>Variance is also crucial for designing experiments, for example if <span class="math inline">\(a\)</span> or <span class="math inline">\(b\)</span> have different signs and <span class="math inline">\(Cov(X,Y)&gt;0\)</span>, then the variance between is reduced because the covariance is subtracted off. This is a justification for within-participant designs, where <span class="math inline">\(X\)</span> represents the first measurement, <span class="math inline">\(Y\)</span> represents a future measurement, <span class="math inline">\(a=-1\)</span> and <span class="math inline">\(b=1\)</span> to reflect a difference comparing the second and first measurements (<span class="math inline">\(Y-X\)</span>), and since the measurements come from the same person here, it is reasonable to assume they are correlated (<span class="math inline">\(Cov(X,Y)&gt;0\)</span>). In this case, <span class="math inline">\(Var(X,Y)=Var(X)+Var(Y)-Cov(X,Y)\)</span>, which is not larger than the variance that would be obtained if the measurements were from independent samples.</p>
<!--
Confidence intervals, prediction intervals
-->
<!--
Variance of a function:
$$
\begin{aligned}
Var(g(x)) &= E((g(x)-E(g(x)))^2)\\
&\approx \left(\frac{d}{dx}g(E(x))\right)^2var(x) 
\end{aligned}
$$
-->
<p><a href="https://en.wikipedia.org/wiki/Law_of_total_variance">Law of total variance</a>: The variance of a variable <span class="math inline">\(X\)</span> can be decomposed into the variation in the variable that remains when <span class="math inline">\(Y\)</span> is known or irreducible error (<span class="math inline">\(E(Var(X|Y))\)</span>), and the variation that carries through from the uncertainty in the model estimation <span class="math inline">\(Y\)</span> (<span class="math inline">\(Var(E(X|Y)\)</span>). <span class="math display">\[
\begin{aligned}
Var(X)&amp;=E(Var(X|Y))+Var(E(X|Y))
\end{aligned}
\]</span></p>
<p>This arises in hierarchical models and prediction intervals.</p>
<p><span class="math display">\[
\begin{aligned}
x               &amp;\sim N(\mu,\sigma)\\
E(x)            &amp;=\mu\\
Var(x)          &amp;=\sigma^2\\
\hat{\mu}_n     &amp;\sim N\left(\mu,\frac{\sigma}{\sqrt{n}}\right)\\
E(\hat{\mu}_n)  &amp;=\mu\\
Var(\hat{\mu}_n)&amp;=\frac{\sigma^2}{n}\\
E(x_{n+1})      &amp;= E(E(x_{n+1}|\hat{\mu}_n))= E(\hat{\mu}_n)=\mu \\
Var(x_{n+1})    &amp;=E(Var(x_{n+1})) + Var(E(x_{n+1}|\mu_{n})\\
                &amp;=\sigma^2+\frac{\sigma^2}{n}\\
(100-\alpha)PI: &amp; E(x_{n+1}|\hat{\mu}_n) \pm T_\alpha \sqrt{Var(x_{n+1})}\\
\end{aligned}
\]</span></p>
<!--
Expectation and variance are the foundation for decision making
- value function v(x) that assigns values to the outcomes x
- If you know the distribution and value function, then you can directly compare choices based on their expected value
-->
<!--
## Models as conditional expectations

Models output an expectation that depends on the model, its structure, its features, and in Bayesian settings it's priors
-->
</div>
<div id="information-theory" class="section level2">
<h2>Information Theory</h2>
<p>Information or Surprise is a measure of how unexpected an event was: <span class="math display">\[
I(x)=-log(f(x))=log\left(\frac{1}{f(x)} \right)
\]</span></p>
<p>Entropy is the expected surprise – higher entropy relates to more uncertainty: <span class="math display">\[
H(X)=E(I(x)) = E(-log(f(x)))  = \int_E f(x)I(x) = -\int_E f(x)log(f(x))
\]</span></p>
<ul>
<li>Joint Entropy</li>
<li>Conditional Entropy</li>
</ul>
<p>K-L Divergance, or relative entropy, is a measure of the expected distance between distributions, assuming one of them is true: <span class="math display">\[
\begin{aligned}
D_{KL}(f_{x}(x);f_{y}(x)) &amp;= \int_{X} f_{x}(x)log\left(\frac{f_{y}(x)}{f_{x}(x)} \right)\\
&amp;= \int_X f_{x}(x)(log(f_{y}(x))-log(f_{x}(x)) \\
\end{aligned}
\]</span></p>
<p>Divergance is an important concept in machine learning, when we are estimating a distribution <span class="math inline">\(f(x)\)</span> with a model <span class="math inline">\(\hat{f}(x)\)</span>. From a Bayesian perspective, Divergance between a prior and posterior measures the information gained by observing the data. Bayesian experimental design focuses on collecting data what would maximize divergance.</p>
<p>Mutual Information is the divergance from the joint distribution <span class="math inline">\(f_{x,y}(x,y)\)</span> to the joint when independence is assumed <span class="math inline">\(f_x(x)f_y(y)\)</span>; <span class="math display">\[
I(x;y)=\int_{y} \int_{x} f_{x,y}(x,y)log\left(\frac{f(x,y)}{f(x)f(y)}  \right)
\]</span></p>
<ul>
<li><p>Divergance</p></li>
<li><p>entropy is minimized by a Bayesian estimator</p></li>
</ul>
</div>
<div id="causal-inference" class="section level2">
<h2>Causal Inference</h2>
</div>
</div>
<div id="experiment-design" class="section level1">
<h1>Experiment Design</h1>
<div id="foundations" class="section level2">
<h2>Foundations</h2>
<ul>
<li>Hypotheses</li>
<li>Treatment and control conditions</li>
<li>assumptions (including CI assumptions, SUTVA, …?)</li>
</ul>
</div>
<div id="concerns" class="section level2">
<h2>Concerns</h2>
<ul>
<li>network effects: front-end, it could be from different interactions, back-end it could be from changes in algorithm behavior for units in C based on different behavior from units in T – e.g. if a new recommender for units in T influences them to watch more of x, then x may also get recommended more to those in C.</li>
<li>learning effects (change aversion, novelty seeking)</li>
<li>early adopters</li>
<li>Non-compliance: Those assicned to treatment may not actually experience the treatment.</li>
<li>Crossover: Those assigned to control might gain access to the treatment.</li>
<li>Treatment inhomogenaity: Some user segments might respond differently than others.</li>
</ul>
</div>
<div id="treatment-units" class="section level2">
<h2>Treatment Units</h2>
<p>What is the unit at which we assign treatments?</p>
<p>Ideally independent individuals, but online it is hard to know who is visiting a webpage, or crucial to keep experiences comparable across devices. Also, in networks, individuals are not independent and it is important to keep user experience consistent across connected individuals.</p>
<p>Proxies for individuals include;</p>
<ul>
<li>User ID or account – most clearly tied to a user, but</li>
<li>cookies – device and browser specific, so these could differ across a user’s browsers or devices.</li>
<li>IP address (device request return address) – device specific, so a user’s experience might differ across devices.</li>
</ul>
<p>In networks, loosely connected clusters of individuals can be used as experimental units (see unofficial google data science blog post on this).</p>
<ul>
<li>a solution to SUTVA violations, but decreases sample size and power dramatically</li>
<li>cluster-based, stratified, serial, balanced, …</li>
<li>propensity scores and matching</li>
</ul>
</div>
<div id="generative-model-and-adjustment-variables" class="section level2">
<h2>Generative Model and Adjustment Variables</h2>
<ul>
<li>Specify the hypothesized generative process</li>
<li>Confounds</li>
<li>Precision</li>
<li>Neusance</li>
</ul>
</div>
<div id="common-designs" class="section level2">
<h2>Common Designs</h2>
<p>A/B testing</p>
<p>A/A testing to estimate variation</p>
<p>Variance reduction designs (paired designs, matching, …)</p>
<p>Bandits for limited data or maximizing an objective</p>
</div>
<div id="assignment-mechanism" class="section level2">
<h2>Assignment Mechanism</h2>
<ul>
<li>maps samples (xi,yi) into treatment or control conditions.</li>
<li>randomized control trials ideal, not always possible</li>
<li>other options, …?</li>
<li>test assignment validity, could use propensity scores or maybe chi square.</li>
</ul>
</div>
<div id="duration" class="section level2">
<h2>Duration</h2>
<ul>
<li>learning effects: initial exploration or novelty seeking</li>
<li>learning effects: initial change aversion</li>
<li>power analysis for sample size</li>
<li>time to run to mitigate</li>
</ul>
<!---
# Experiment Design

## Objective, demand, and value

Objective is based on a metric (increase clickthrough or revenue per user). 

Demand -- if adding a new user feature, how can demand for the feature be assessed? 

value = benefit - cost. 

Expected value helps with decisions about the size and duration of an experiment

## Constructs, metrics, and scoping

Once an objective is clear, the details of what can be measured need to be flushed out. 

Metrics (fill in from udamy course section on metrics)

Netflix metrics -- streaming hours, retention (users staying on platform), viewing for a title (e.g. effected by artwork -- but may be at the detrement of general viewing?) 

### User flow and target metrics

Think of the sequence of actions a user might take on the site. Experiments can target transtition probabilities between any user/platform states. 

- number of clicks
- time on page
- ... 

### Invariants

Metrics that shouldn't change or differ across groups. For example, demographic variables should be the same across groups if the randomization or balancing worked properly. Also, many application performance metrics and business metrics should be unchanged, or monitored just in case they change. 

### Confounding variables

Mitigated by randomization. 

### Precision variables

Can also highlight features that one would want to match treatment and control on.

Examples: 

- number of posts
- number of followers
- visibility / impressions

## Metric Validation

User expreience research, retrospective analyses of past data or log files, ... . 

## Conditions

Define the experimental manipulations. 

## Treatment Units

What is the unit at which we assign treatments? 

Ideally independent individuals, but online it is hard to know who is visiting a webpage, or crucial to keep experiences comparable across devices. Also, in networks, individuals are not independent and it is important to keep user experience consistent across connected individuals. 

Proxies for individuals include;

- User ID or account -- most clearly tied to a user, but 
- cookies -- device and browser specific, so these could differ across a user's browsers or devices.
- IP address (device request return address) -- device specific, so a user's experience might differ across devices.

In networks, loosely connected clusters of individuals can be used as experimental units (see unofficial google data science blog post on this).

## Assignment Mechanism 

The assignment mechanism samples members from a population and assignes them to conditions. 

How are units assigned to treatments?

Randomized control trials are the ideal, but many issues arise in online experimentation settings. 

(look up desirable properties form causal inference notes)

### Population 

What group is being sampled from?

### Cohorts

Random sample, cluster-based, stratified, serial, balanced, ... 

### Synthetic Control Groups

Propensity matching

### Limitations

- Non-compliance: Those assicned to treatment may not actually experience the treatment. 
- Crossover: Those assigned to control might gain access to the treatment. 
- Treatment inhomogenaity: Some user segments might respond differently than others.

# Implementation

Batched, or real-time

## Size

power, sample size

## Duration

- learning effects: initial exploration or novelty seeking
- learning effects: initial change aversion

Solution: Consider running experiment past any initial observed effect.

### Temporal variation

### Optional stopping

Why it's an issue for frequentists

Optamizely using a threshold on FDR from likelihood ratio tests in frequentist setting

Bayesian justifications

p-values versus likelihood ratios

## Estimands

- Average treatment effect
- Treatment on treated

## Effiencicy or Variance Reduction

- look up variance reduction in A/B tests, a common method might be to incorporate precision variables like demographic data or user data such as device or browser. 

e.g. with a two sample t-test, $Y_t - Y_{t-1} = \beta_0$, versus a model $Y_t = \beta_0 + \beta_1 Y_{t-1}$

- get table for different tests of means from soc sci 10 notes.

## Checking assignment integrety

- Check demographics across buckets, if randomization worked then demographics should be approximately equally represented in the buckets. 

--->
</div>
<div id="integrety-checks" class="section level2">
<h2>Integrety Checks</h2>
<ul>
<li>check that those assigned to treatment received it</li>
<li>check that stratifications were implemented correctly</li>
<li>Check demographics across buckets, if randomization worked then demographics should be approximately equally represented in the buckets.</li>
</ul>
</div>
<div id="maximum-likelihood-versus-bayes-estimators" class="section level2">
<h2>Maximum Likelihood versus Bayes’ Estimators</h2>
<p>likelihood is one term in Bayes’ Theorem</p>
</div>
</div>
<div id="glms" class="section level1">
<h1>GLMs</h1>
<p>Again about the variance – this time it takes a form other than normal.</p>
<p>likelihood, score, fisher information, robust veriance, …?</p>
</div>
<div id="common-tests" class="section level1">
<h1>Common Tests</h1>
<div id="t-test" class="section level2">
<h2>t-test</h2>
<ul>
<li>different variance formulations.</li>
<li>one-sample</li>
<li>two independent sampels</li>
<li>two dependent samples</li>
</ul>
</div>
<div id="anova" class="section level2">
<h2>ANOVA</h2>
</div>
<div id="linear-model" class="section level2">
<h2>Linear Model</h2>
</div>
<div id="z-test-for-proportions" class="section level2">
<h2>Z test for proportions</h2>
<p>Binary data</p>
</div>
<div id="chi-square" class="section level2">
<h2>Chi-Square</h2>
</div>
<div id="logistic-regression" class="section level2">
<h2>Logistic Regression</h2>
</div>
<div id="likelihood-ratio-and-bayes-factors" class="section level2">
<h2>Likelihood Ratio and Bayes Factors</h2>
</div>
<div id="always-valid-p-values-ck-optimizely-white-paper" class="section level2">
<h2>always valid p-values (ck optimizely white paper)</h2>
</div>
</div>
<div id="different-estimands-for-ci" class="section level1">
<h1>Different Estimands For CI</h1>
<ul>
<li>Average treatment effect</li>
<li>Treatment on treated</li>
</ul>
</div>
<div id="more-on-variance" class="section level1">
<h1>more on variance</h1>
<div id="emperical-variance-estimation" class="section level2">
<h2>Emperical Variance Estimation</h2>
<p>bootstrapping</p>
<p>A/A testing</p>
</div>
<div id="mixed-effects-models" class="section level2">
<h2>Mixed Effects Models</h2>
<ul>
<li>Maime’s consulting project? Other use cases?</li>
</ul>
</div>
<div id="effiencicy-or-variance-reduction" class="section level2">
<h2>Effiencicy or Variance Reduction</h2>
<ul>
<li>look up variance reduction in A/B tests, a common method might be to incorporate precision variables like demographic data or user data such as device or browser.</li>
</ul>
<p>e.g. with a two sample t-test, <span class="math inline">\(Y_t - Y_{t-1} = \beta_0\)</span>, versus a model <span class="math inline">\(Y_t = \beta_0 + \beta_1 Y_{t-1}\)</span></p>
<ul>
<li>get table for different tests of means from soc sci 10 notes.</li>
</ul>
</div>
<div id="glms-1" class="section level2">
<h2>GLMs</h2>
<!--
models for when the errors aren't assumed to be normally distributed
--->
<p>Stats: descriptive, R-squared, chi-squared;</p>
<p>Probability: distributions, CLT, sampling distributions, p-value,</p>
<p>Stats: k-s, Q-Q plot, hypothesis testing, experimentation;</p>
<p>Probability: Bayes, bootstrap</p>
<p>Probability: maximum likelihood estimation; time series analysis (ARIMA models), granger causality</p>
<p>Dynamic experimentation (multi-armed bandits)</p>
<p>Unit testing; EDA visualization (seaborn, Plotly, Bokeh)</p>
</div>
</div>
<div id="causal-inference-methods" class="section level1">
<h1>Causal Inference Methods</h1>
<p>Good medium blog post <a href="https://towardsdatascience.com/causal-inference-using-difference-in-differences-causal-impact-and-synthetic-control-f8639c408268">here</a></p>
<p>For each mention the assumptions and the model.</p>
<div id="difference-in-differences" class="section level2">
<h2>Difference in Differences</h2>
</div>
<div id="causal-impact" class="section level2">
<h2>Causal Impact</h2>
</div>
<div id="synthetic-controls" class="section level2">
<h2>Synthetic Controls</h2>
</div>
<div id="propensity-score-matching" class="section level2">
<h2>Propensity Score Matching</h2>
</div>
<div id="fixed-effects-regression" class="section level2">
<h2>Fixed Effects Regression</h2>
</div>
<div id="instrumental-variables" class="section level2">
<h2>Instrumental variables</h2>
</div>
<div id="regression-discontinuity" class="section level2">
<h2>Regression Discontinuity</h2>
</div>
</div>
